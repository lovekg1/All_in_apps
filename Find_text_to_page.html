<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Text Search</title>
    <script type="module">
        import * as pdfjsLib from 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.269/+esm';

        // Ensure pdfjsLib is defined before accessing properties
        if (pdfjsLib) {
            pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdn.jsdelivr.net/npm/pdfjs-dist@4.0.269/build/pdf.worker.min.mjs';
        } else {
            console.error('pdfjsLib is not defined. Make sure the library is loaded correctly.');
        }
    </script>
    <style>
        .pdf-page {
            border: 1px solid #ccc;
            margin-bottom: 10px;
            padding: 10px;
        }
    </style>

</head>

<body>
    <input type="file" id="pdfInput" accept=".pdf">
    <input type="text" id="searchInput" placeholder="Enter text to search">
    <button onclick="searchInPDF()">Search</button>
    <div id="result"></div>

    <script>
        async function searchInPDF() {
            const pdfInput = document.getElementById('pdfInput');
            const searchInput = document.getElementById('searchInput');
            const resultDiv = document.getElementById('result');

            const file = pdfInput.files[0];
            const searchText = searchInput.value;

            if (!file || !searchText) {
                alert('Please select a PDF file and enter search text.');
                return;
            }

            const fileReader = new FileReader();

            fileReader.onload = async function () {
                const typedArray = new Uint8Array(this.result);

                if (pdfjsLib) {
                    const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;

                    const numPages = pdf.numPages;

                    // Clear previous search results
                    resultDiv.innerHTML = ''

                    for (let pageNumber = 1; pageNumber <= numPages; pageNumber++) {
                        const page = await pdf.getPage(pageNumber);
                        const textContent = await page.getTextContent();
                        const text = textContent.items.map((s) => s.str).join('');

                        if (text.includes(searchText)) {
                            // Create a new div for each page
                            const pageDiv = document.createElement('div');
                            pageDiv.classList.add('pdf-page');

                            // Append the page number to the div
                            pageDiv.innerHTML = `<p>Page ${pageNumber}</p>`;

                            // Append the div to the resultDiv
                            resultDiv.appendChild(pageDiv);
                        }
                    }

                    if (resultDiv.childElementCount === 0) {
                        resultDiv.innerHTML = 'Text not found in the PDF';
                    }
                } else {
                    console.error('pdfjsLib is not defined. Make sure the library is loaded correctly.');
                }
            };

            fileReader.readAsArrayBuffer(file);
        }
    </script>
</body>

</html>